{"ast":null,"code":"import * as d3 from \"d3\";\nimport dataTransform from \"../dataTransform\";\nimport { dispatch } from \"../events\";\nimport { colorParse } from \"../colorHelper\";\n/**\n * Reusable 3D Bubble Chart Component\n *\n * @module\n */\n\nexport default function () {\n  /* Default Properties */\n  let dimensions = {\n    x: 40,\n    y: 40,\n    z: 40\n  };\n  let colors = d3.schemeRdYlGn[8];\n  let color;\n  let classed = \"d3X3dBubbles\";\n  let mappings;\n  /* Scales */\n\n  let xScale;\n  let yScale;\n  let zScale;\n  let colorScale;\n  let sizeScale;\n  let sizeRange = [0.2, 4.0];\n  /**\n   * Initialise Data and Scales\n   *\n   * @private\n   * @param {Array} data - Chart data.\n   */\n\n  const init = function (data) {\n    let newData = {};\n    ['x', 'y', 'z', 'size', 'color'].forEach(dimension => {\n      let set = {\n        key: dimension,\n        values: []\n      };\n      data.values.forEach(d => {\n        let key = mappings[dimension];\n        let value = d.values.find(v => v.key === key).value;\n        set.values.push({\n          key: key,\n          value: value\n        });\n      });\n      newData[dimension] = dataTransform(set).summary();\n    });\n    let extentX = newData.x.valueExtent;\n    let extentY = newData.y.valueExtent;\n    let extentZ = newData.z.valueExtent;\n    let extentSize = newData.size.valueExtent;\n    let extentColor = newData.color.valueExtent;\n\n    if (typeof xScale === \"undefined\") {\n      xScale = d3.scaleLinear().domain(extentX).range([0, dimensions.x]);\n    }\n\n    if (typeof yScale === \"undefined\") {\n      yScale = d3.scaleLinear().domain(extentY).range([0, dimensions.y]);\n    }\n\n    if (typeof zScale === \"undefined\") {\n      zScale = d3.scaleLinear().domain(extentZ).range([0, dimensions.z]);\n    }\n\n    if (typeof sizeScale === \"undefined\") {\n      sizeScale = d3.scaleLinear().domain(extentSize).range(sizeRange);\n    }\n\n    if (color) {\n      colorScale = d3.scaleQuantize().domain(extentColor).range([color, color]);\n    } else if (typeof colorScale === \"undefined\") {\n      colorScale = d3.scaleQuantize().domain(extentColor).range(colors);\n    }\n  };\n  /**\n   * Constructor\n   *\n   * @constructor\n   * @alias bubbles\n   * @param {d3.selection} selection - The chart holder D3 selection.\n   */\n\n\n  const my = function (selection) {\n    selection.each(function (data) {\n      init(data);\n      const element = d3.select(this).classed(classed, true).attr(\"id\", d => d.key);\n\n      const shape = el => {\n        const shape = el.append(\"Shape\");\n        shape.append(\"Sphere\").attr(\"radius\", d => {\n          let sizeVal = d.values.find(v => v.key === mappings.size).value;\n          return sizeScale(sizeVal);\n        });\n        shape.append(\"Appearance\").append(\"Material\").attr(\"diffuseColor\", d => {\n          let colorVal = d.values.find(v => v.key === mappings.color).value;\n          return colorParse(colorScale(colorVal));\n        }).attr(\"ambientIntensity\", 0.1);\n        return shape;\n      };\n\n      const bubbles = element.selectAll(\".bubble\").data(d => d.values, d => d.key);\n      const bubblesEnter = bubbles.enter().append(\"Transform\").attr(\"class\", \"bubble\").call(shape).merge(bubbles);\n      const bubblesTransition = bubblesEnter.transition();\n      bubblesTransition.attr(\"translation\", d => {\n        let xVal = d.values.find(v => v.key === mappings.x).value;\n        let yVal = d.values.find(v => v.key === mappings.y).value;\n        let zVal = d.values.find(v => v.key === mappings.z).value;\n        return xScale(xVal) + \" \" + yScale(yVal) + \" \" + zScale(zVal);\n      });\n      bubblesTransition.select(\"Shape\").select(\"Sphere\").attr(\"radius\", d => {\n        let sizeVal = d.values.find(v => v.key === mappings.size).value;\n        return sizeScale(sizeVal);\n      });\n      bubblesTransition.select(\"Shape\").select(\"Appearance\").select(\"Material\").attr(\"diffuseColor\", d => {\n        let colorVal = d.values.find(v => v.key === mappings.color).value;\n        return colorParse(colorScale(colorVal));\n      });\n      bubbles.exit().remove();\n    });\n  };\n  /**\n   * Dimensions Getter / Setter\n   *\n   * @param {{x: number, y: number, z: number}} _v - 3D object dimensions.\n   * @returns {*}\n   */\n\n\n  my.dimensions = function (_v) {\n    if (!arguments.length) return dimensions;\n    dimensions = _v;\n    return this;\n  };\n  /**\n   * X Scale Getter / Setter\n   *\n   * @param {d3.scale} _v - D3 scale.\n   * @returns {*}\n   */\n\n\n  my.xScale = function (_v) {\n    if (!arguments.length) return xScale;\n    xScale = _v;\n    return my;\n  };\n  /**\n   * Y Scale Getter / Setter\n   *\n   * @param {d3.scale} _v - D3 scale.\n   * @returns {*}\n   */\n\n\n  my.yScale = function (_v) {\n    if (!arguments.length) return yScale;\n    yScale = _v;\n    return my;\n  };\n  /**\n   * Z Scale Getter / Setter\n   *\n   * @param {d3.scale} _v - D3 scale.\n   * @returns {*}\n   */\n\n\n  my.zScale = function (_v) {\n    if (!arguments.length) return zScale;\n    zScale = _v;\n    return my;\n  };\n  /**\n   * Size Scale Getter / Setter\n   *\n   * @param {d3.scale} _v - D3 size scale.\n   * @returns {*}\n   */\n\n\n  my.sizeScale = function (_v) {\n    if (!arguments.length) return sizeScale;\n    sizeScale = _v;\n    return my;\n  };\n  /**\n   * Size Range Getter / Setter\n   *\n   * @param {number[]} _v - Size min and max (e.g. [1, 9]).\n   * @returns {*}\n   */\n\n\n  my.sizeRange = function (_v) {\n    if (!arguments.length) return sizeRange;\n    sizeRange = _v;\n    return my;\n  };\n  /**\n   * Color Scale Getter / Setter\n   *\n   * @param {d3.scale} _v - D3 color scale.\n   * @returns {*}\n   */\n\n\n  my.colorScale = function (_v) {\n    if (!arguments.length) return colorScale;\n    colorScale = _v;\n    return my;\n  };\n  /**\n   * Color Getter / Setter\n   *\n   * @param {string} _v - Color (e.g. \"red\" or \"#ff0000\").\n   * @returns {*}\n   */\n\n\n  my.color = function (_v) {\n    if (!arguments.length) return color;\n    color = _v;\n    return my;\n  };\n  /**\n   * Colors Getter / Setter\n   *\n   * @param {Array} _v - Array of colours used by color scale.\n   * @returns {*}\n   */\n\n\n  my.colors = function (_v) {\n    if (!arguments.length) return colors;\n    colors = _v;\n    return my;\n  };\n  /**\n   * Mappings Getter / Setter\n   *\n   * @param {Object} _v - Map properties to size, colour etc.\n   * @returns {*}\n   */\n\n\n  my.mappings = function (_v) {\n    if (!arguments.length) return mappings;\n    mappings = _v;\n    return my;\n  };\n  /**\n   * Dispatch On Getter\n   *\n   * @returns {*}\n   */\n\n\n  my.on = function () {\n    let value = dispatch.on.apply(dispatch, arguments);\n    return value === dispatch ? my : value;\n  };\n\n  return my;\n}","map":{"version":3,"sources":["C:/Users/Michael Wilke/Desktop/Scout/frontend/node_modules/d3-x3d/src/component/bubbles.js"],"names":["d3","dataTransform","dispatch","colorParse","dimensions","x","y","z","colors","schemeRdYlGn","color","classed","mappings","xScale","yScale","zScale","colorScale","sizeScale","sizeRange","init","data","newData","forEach","dimension","set","key","values","d","value","find","v","push","summary","extentX","valueExtent","extentY","extentZ","extentSize","size","extentColor","scaleLinear","domain","range","scaleQuantize","my","selection","each","element","select","attr","shape","el","append","sizeVal","colorVal","bubbles","selectAll","bubblesEnter","enter","call","merge","bubblesTransition","transition","xVal","yVal","zVal","exit","remove","_v","arguments","length","on","apply"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\";\nimport dataTransform from \"../dataTransform\";\nimport { dispatch } from \"../events\";\nimport { colorParse } from \"../colorHelper\";\n\n/**\n * Reusable 3D Bubble Chart Component\n *\n * @module\n */\nexport default function() {\n\n\t/* Default Properties */\n\tlet dimensions = { x: 40, y: 40, z: 40 };\n\tlet colors = d3.schemeRdYlGn[8];\n\tlet color;\n\tlet classed = \"d3X3dBubbles\";\n\tlet mappings;\n\n\t/* Scales */\n\tlet xScale;\n\tlet yScale;\n\tlet zScale;\n\tlet colorScale;\n\tlet sizeScale;\n\tlet sizeRange = [0.2, 4.0];\n\n\t/**\n\t * Initialise Data and Scales\n\t *\n\t * @private\n\t * @param {Array} data - Chart data.\n\t */\n\tconst init = function(data) {\n\t\tlet newData = {};\n\t\t['x', 'y', 'z', 'size', 'color'].forEach((dimension) => {\n\t\t\tlet set = {\n\t\t\t\tkey: dimension,\n\t\t\t\tvalues: []\n\t\t\t};\n\n\t\t\tdata.values.forEach((d) => {\n\t\t\t\tlet key = mappings[dimension];\n\t\t\t\tlet value = d.values.find((v) => v.key === key).value;\n\t\t\t\tset.values.push({ key: key, value: value });\n\t\t\t});\n\n\t\t\tnewData[dimension] = dataTransform(set).summary();\n\t\t});\n\n\t\tlet extentX = newData.x.valueExtent;\n\t\tlet extentY = newData.y.valueExtent;\n\t\tlet extentZ = newData.z.valueExtent;\n\t\tlet extentSize = newData.size.valueExtent;\n\t\tlet extentColor = newData.color.valueExtent;\n\n\t\tif (typeof xScale === \"undefined\") {\n\t\t\txScale = d3.scaleLinear()\n\t\t\t\t.domain(extentX)\n\t\t\t\t.range([0, dimensions.x]);\n\t\t}\n\n\t\tif (typeof yScale === \"undefined\") {\n\t\t\tyScale = d3.scaleLinear()\n\t\t\t\t.domain(extentY)\n\t\t\t\t.range([0, dimensions.y]);\n\t\t}\n\n\t\tif (typeof zScale === \"undefined\") {\n\t\t\tzScale = d3.scaleLinear()\n\t\t\t\t.domain(extentZ)\n\t\t\t\t.range([0, dimensions.z]);\n\t\t}\n\n\t\tif (typeof sizeScale === \"undefined\") {\n\t\t\tsizeScale = d3.scaleLinear()\n\t\t\t\t.domain(extentSize)\n\t\t\t\t.range(sizeRange);\n\t\t}\n\n\t\tif (color) {\n\t\t\tcolorScale = d3.scaleQuantize()\n\t\t\t\t.domain(extentColor)\n\t\t\t\t.range([color, color]);\n\t\t} else if (typeof colorScale === \"undefined\") {\n\t\t\tcolorScale = d3.scaleQuantize()\n\t\t\t\t.domain(extentColor)\n\t\t\t\t.range(colors);\n\t\t}\n\t};\n\n\t/**\n\t * Constructor\n\t *\n\t * @constructor\n\t * @alias bubbles\n\t * @param {d3.selection} selection - The chart holder D3 selection.\n\t */\n\tconst my = function(selection) {\n\t\tselection.each(function(data) {\n\t\t\tinit(data);\n\n\t\t\tconst element = d3.select(this)\n\t\t\t\t.classed(classed, true)\n\t\t\t\t.attr(\"id\", (d) => d.key);\n\n\t\t\tconst shape = (el) => {\n\t\t\t\tconst shape = el.append(\"Shape\");\n\n\t\t\t\tshape.append(\"Sphere\")\n\t\t\t\t\t.attr(\"radius\", (d) => {\n\t\t\t\t\t\tlet sizeVal = d.values.find((v) => v.key === mappings.size).value;\n\t\t\t\t\t\treturn sizeScale(sizeVal);\n\t\t\t\t\t});\n\n\t\t\t\tshape.append(\"Appearance\")\n\t\t\t\t\t.append(\"Material\")\n\t\t\t\t\t.attr(\"diffuseColor\", (d) => {\n\t\t\t\t\t\tlet colorVal = d.values.find((v) => v.key === mappings.color).value;\n\t\t\t\t\t\treturn colorParse(colorScale(colorVal));\n\t\t\t\t\t})\n\t\t\t\t\t.attr(\"ambientIntensity\", 0.1);\n\n\t\t\t\treturn shape;\n\t\t\t};\n\n\t\t\tconst bubbles = element.selectAll(\".bubble\")\n\t\t\t\t.data((d) => d.values, (d) => d.key);\n\n\t\t\tconst bubblesEnter = bubbles.enter()\n\t\t\t\t.append(\"Transform\")\n\t\t\t\t.attr(\"class\", \"bubble\")\n\t\t\t\t.call(shape)\n\t\t\t\t.merge(bubbles);\n\n\t\t\tconst bubblesTransition = bubblesEnter.transition();\n\t\t\tbubblesTransition.attr(\"translation\", (d) => {\n\t\t\t\tlet xVal = d.values.find((v) => v.key === mappings.x).value;\n\t\t\t\tlet yVal = d.values.find((v) => v.key === mappings.y).value;\n\t\t\t\tlet zVal = d.values.find((v) => v.key === mappings.z).value;\n\t\t\t\treturn xScale(xVal) + \" \" + yScale(yVal) + \" \" + zScale(zVal);\n\t\t\t});\n\n\t\t\tbubblesTransition.select(\"Shape\")\n\t\t\t\t.select(\"Sphere\")\n\t\t\t\t.attr(\"radius\", (d) => {\n\t\t\t\t\tlet sizeVal = d.values.find((v) => v.key === mappings.size).value;\n\t\t\t\t\treturn sizeScale(sizeVal);\n\t\t\t\t});\n\n\t\t\tbubblesTransition.select(\"Shape\")\n\t\t\t\t.select(\"Appearance\")\n\t\t\t\t.select(\"Material\")\n\t\t\t\t.attr(\"diffuseColor\", (d) => {\n\t\t\t\t\tlet colorVal = d.values.find((v) => v.key === mappings.color).value;\n\t\t\t\t\treturn colorParse(colorScale(colorVal));\n\t\t\t\t});\n\n\t\t\tbubbles.exit()\n\t\t\t\t.remove();\n\t\t});\n\t};\n\n\t/**\n\t * Dimensions Getter / Setter\n\t *\n\t * @param {{x: number, y: number, z: number}} _v - 3D object dimensions.\n\t * @returns {*}\n\t */\n\tmy.dimensions = function(_v) {\n\t\tif (!arguments.length) return dimensions;\n\t\tdimensions = _v;\n\t\treturn this;\n\t};\n\n\t/**\n\t * X Scale Getter / Setter\n\t *\n\t * @param {d3.scale} _v - D3 scale.\n\t * @returns {*}\n\t */\n\tmy.xScale = function(_v) {\n\t\tif (!arguments.length) return xScale;\n\t\txScale = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Y Scale Getter / Setter\n\t *\n\t * @param {d3.scale} _v - D3 scale.\n\t * @returns {*}\n\t */\n\tmy.yScale = function(_v) {\n\t\tif (!arguments.length) return yScale;\n\t\tyScale = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Z Scale Getter / Setter\n\t *\n\t * @param {d3.scale} _v - D3 scale.\n\t * @returns {*}\n\t */\n\tmy.zScale = function(_v) {\n\t\tif (!arguments.length) return zScale;\n\t\tzScale = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Size Scale Getter / Setter\n\t *\n\t * @param {d3.scale} _v - D3 size scale.\n\t * @returns {*}\n\t */\n\tmy.sizeScale = function(_v) {\n\t\tif (!arguments.length) return sizeScale;\n\t\tsizeScale = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Size Range Getter / Setter\n\t *\n\t * @param {number[]} _v - Size min and max (e.g. [1, 9]).\n\t * @returns {*}\n\t */\n\tmy.sizeRange = function(_v) {\n\t\tif (!arguments.length) return sizeRange;\n\t\tsizeRange = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Color Scale Getter / Setter\n\t *\n\t * @param {d3.scale} _v - D3 color scale.\n\t * @returns {*}\n\t */\n\tmy.colorScale = function(_v) {\n\t\tif (!arguments.length) return colorScale;\n\t\tcolorScale = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Color Getter / Setter\n\t *\n\t * @param {string} _v - Color (e.g. \"red\" or \"#ff0000\").\n\t * @returns {*}\n\t */\n\tmy.color = function(_v) {\n\t\tif (!arguments.length) return color;\n\t\tcolor = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Colors Getter / Setter\n\t *\n\t * @param {Array} _v - Array of colours used by color scale.\n\t * @returns {*}\n\t */\n\tmy.colors = function(_v) {\n\t\tif (!arguments.length) return colors;\n\t\tcolors = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Mappings Getter / Setter\n\t *\n\t * @param {Object} _v - Map properties to size, colour etc.\n\t * @returns {*}\n\t */\n\tmy.mappings = function(_v) {\n\t\tif (!arguments.length) return mappings;\n\t\tmappings = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Dispatch On Getter\n\t *\n\t * @returns {*}\n\t */\n\tmy.on = function() {\n\t\tlet value = dispatch.on.apply(dispatch, arguments);\n\t\treturn value === dispatch ? my : value;\n\t};\n\n\treturn my;\n}\n"]},"metadata":{},"sourceType":"module"}