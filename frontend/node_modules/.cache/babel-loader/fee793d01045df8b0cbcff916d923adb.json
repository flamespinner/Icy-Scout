{"ast":null,"code":"import * as d3 from \"d3\";\nimport dataTransform from \"../dataTransform\";\nimport component from \"../component\";\nimport { dispatch } from \"../events\";\nimport { createScene } from \"../base\";\n/**\n * Reusable 3D Scatter Plot Chart\n *\n * @module\n *\n * @example\n * let chartHolder = d3.select(\"#chartholder\");\n *\n * let myData = [...];\n *\n * let myChart = d3.x3d.chart.scatterPlot();\n *\n * chartHolder.datum(myData).call(myChart);\n *\n * @see https://datavizproject.com/data-type/3d-scatterplot/\n */\n\nexport default function () {\n  /* Default Properties */\n  let width = 500;\n  let height = 500;\n  let dimensions = {\n    x: 40,\n    y: 40,\n    z: 40\n  };\n  let colors = [\"orange\"];\n  let color;\n  let classed = \"d3X3dScatterPlot\";\n  let mappings;\n  let debug = false;\n  /* Scales */\n\n  let xScale;\n  let yScale;\n  let zScale;\n  let colorScale;\n  let sizeScale;\n  let sizeRange = [0.2];\n  /* Components */\n\n  const viewpoint = component.viewpoint();\n  const axis = component.axisThreePlane();\n  const crosshair = component.crosshair();\n  const label = component.label();\n  const bubbles = component.bubbles();\n  /**\n   * Initialise Data and Scales\n   *\n   * @private\n   * @param {Array} data - Chart data.\n   */\n\n  const init = function (data) {\n    let newData = {};\n    ['x', 'y', 'z', 'size', 'color'].forEach(dimension => {\n      let set = {\n        key: dimension,\n        values: []\n      };\n      data.values.forEach(d => {\n        let key = mappings[dimension];\n        let value = d.values.find(v => v.key === key).value;\n        set.values.push({\n          key: key,\n          value: value\n        });\n      });\n      newData[dimension] = dataTransform(set).summary();\n    });\n    let extentX = newData.x.valueExtent;\n    let extentY = newData.y.valueExtent;\n    let extentZ = newData.z.valueExtent;\n    let extentSize = newData.size.valueExtent;\n    let extentColor = newData.color.valueExtent;\n    xScale = d3.scaleLinear().domain(extentX).range([0, dimensions.x]);\n    yScale = d3.scaleLinear().domain(extentY).range([0, dimensions.y]);\n    zScale = d3.scaleLinear().domain(extentZ).range([0, dimensions.z]);\n    sizeScale = d3.scaleLinear().domain(extentSize).range(sizeRange);\n\n    if (color) {\n      colorScale = d3.scaleQuantize().domain(extentColor).range([color, color]);\n    } else {\n      colorScale = d3.scaleQuantize().domain(extentColor).range(colors);\n    }\n  };\n  /**\n   * Constructor\n   *\n   * @constructor\n   * @alias scatterPlot\n   * @param {d3.selection} selection - The chart holder D3 selection.\n   */\n\n\n  const my = function (selection) {\n    const layers = [\"axis\", \"bubbles\", \"crosshair\", \"label\"];\n    const scene = createScene(selection, layers, classed, width, height, debug);\n    selection.each(data => {\n      init(data); // Add Viewpoint\n\n      viewpoint.centerOfRotation([dimensions.x / 2, dimensions.y / 2, dimensions.z / 2]);\n      scene.call(viewpoint); // Add Axis\n\n      axis.xScale(xScale).yScale(yScale).zScale(zScale);\n      scene.select(\".axis\").call(axis); // Add Crosshair\n\n      crosshair.xScale(xScale).yScale(yScale).zScale(zScale); // Add Labels\n\n      label.xScale(xScale).yScale(yScale).zScale(zScale).offset(0.5); // Add Bubbles\n\n      bubbles.xScale(xScale).mappings(mappings).yScale(yScale).zScale(zScale).sizeScale(sizeScale).colorScale(colorScale).on(\"d3X3dClick\", function (e) {\n        const d = d3.select(e.target).datum();\n        scene.select(\".crosshair\").datum(d).classed(\"crosshair\", true).each(function () {\n          d3.select(this).call(crosshair);\n        });\n      }).on(\"d3X3dMouseOver\", function (e) {\n        const d = d3.select(e.target).datum();\n        scene.select(\".label\").datum(d).each(function () {\n          d3.select(this).call(label);\n        });\n      }).on(\"d3X3dMouseOut\", function (e) {\n        scene.select(\".label\").selectAll(\"*\").remove();\n      });\n      scene.select(\".bubbles\").datum(data).call(bubbles);\n    });\n  };\n  /**\n   * Width Getter / Setter\n   *\n   * @param {number} _v - X3D canvas width in px.\n   * @returns {*}\n   */\n\n\n  my.width = function (_v) {\n    if (!arguments.length) return width;\n    width = _v;\n    return this;\n  };\n  /**\n   * Height Getter / Setter\n   *\n   * @param {number} _v - X3D canvas height in px.\n   * @returns {*}\n   */\n\n\n  my.height = function (_v) {\n    if (!arguments.length) return height;\n    height = _v;\n    return this;\n  };\n  /**\n   * Dimensions Getter / Setter\n   *\n   * @param {{x: number, y: number, z: number}} _v - 3D object dimensions.\n   * @returns {*}\n   */\n\n\n  my.dimensions = function (_v) {\n    if (!arguments.length) return dimensions;\n    dimensions = _v;\n    return this;\n  };\n  /**\n   * X Scale Getter / Setter\n   *\n   * @param {d3.scale} _v - D3 scale.\n   * @returns {*}\n   */\n\n\n  my.xScale = function (_v) {\n    if (!arguments.length) return xScale;\n    xScale = _v;\n    return my;\n  };\n  /**\n   * Y Scale Getter / Setter\n   *\n   * @param {d3.scale} _v - D3 scale.\n   * @returns {*}\n   */\n\n\n  my.yScale = function (_v) {\n    if (!arguments.length) return yScale;\n    yScale = _v;\n    return my;\n  };\n  /**\n   * Z Scale Getter / Setter\n   *\n   * @param {d3.scale} _v - D3 scale.\n   * @returns {*}\n   */\n\n\n  my.zScale = function (_v) {\n    if (!arguments.length) return zScale;\n    zScale = _v;\n    return my;\n  };\n  /**\n   * Size Scale Getter / Setter\n   *\n   * @param {d3.scale} _v - D3 color scale.\n   * @returns {*}\n   */\n\n\n  my.sizeScale = function (_v) {\n    if (!arguments.length) return sizeScale;\n    sizeScale = _v;\n    return my;\n  };\n  /**\n   * Size Range Getter / Setter\n   *\n   * @param {number[]} _v - Size min and max (e.g. [1, 9]).\n   * @returns {*}\n   */\n\n\n  my.sizeRange = function (_v) {\n    if (!arguments.length) return sizeRange;\n    sizeRange = _v;\n    return my;\n  };\n  /**\n   * Color Scale Getter / Setter\n   *\n   * @param {d3.scale} _v - D3 color scale.\n   * @returns {*}\n   */\n\n\n  my.colorScale = function (_v) {\n    if (!arguments.length) return colorScale;\n    colorScale = _v;\n    return my;\n  };\n  /**\n   * Color Getter / Setter\n   *\n   * @param {string} _v - Color (e.g. \"red\" or \"#ff0000\").\n   * @returns {*}\n   */\n\n\n  my.color = function (_v) {\n    if (!arguments.length) return color;\n    color = _v;\n    return my;\n  };\n  /**\n   * Colors Getter / Setter\n   *\n   * @param {Array} _v - Array of colours used by color scale.\n   * @returns {*}\n   */\n\n\n  my.colors = function (_v) {\n    if (!arguments.length) return colors;\n    colors = _v;\n    return my;\n  };\n  /**\n   * Size Scale Getter / Setter\n   *\n   * @param {d3.scale} _v - D3 color scale.\n   * @returns {*}\n   */\n\n\n  my.sizeScale = function (_v) {\n    if (!arguments.length) return sizeScale;\n    sizeScale = _v;\n    return my;\n  };\n  /**\n   * Size Range Getter / Setter\n   *\n   * @param {number[]} _v - Size min and max (e.g. [0.5, 3.0]).\n   * @returns {*}\n   */\n\n\n  my.sizeRange = function (_v) {\n    if (!arguments.length) return sizeRange;\n    sizeRange = _v;\n    return my;\n  };\n  /**\n   * Mappings Getter / Setter\n   *\n   * @param {Object} _v - Map properties to size, colour etc.\n   * @returns {*}\n   */\n\n\n  my.mappings = function (_v) {\n    if (!arguments.length) return mappings;\n    mappings = _v;\n    return my;\n  };\n  /**\n   * Debug Getter / Setter\n   *\n   * @param {boolean} _v - Show debug log and stats. True/False.\n   * @returns {*}\n   */\n\n\n  my.debug = function (_v) {\n    if (!arguments.length) return debug;\n    debug = _v;\n    return my;\n  };\n  /**\n   * Dispatch On Getter\n   *\n   * @returns {*}\n   */\n\n\n  my.on = function () {\n    let value = dispatch.on.apply(dispatch, arguments);\n    return value === dispatch ? my : value;\n  };\n\n  return my;\n}","map":{"version":3,"sources":["C:/Users/Michael Wilke/Desktop/Scout/frontend/node_modules/d3-x3d/src/chart/scatterPlot.js"],"names":["d3","dataTransform","component","dispatch","createScene","width","height","dimensions","x","y","z","colors","color","classed","mappings","debug","xScale","yScale","zScale","colorScale","sizeScale","sizeRange","viewpoint","axis","axisThreePlane","crosshair","label","bubbles","init","data","newData","forEach","dimension","set","key","values","d","value","find","v","push","summary","extentX","valueExtent","extentY","extentZ","extentSize","size","extentColor","scaleLinear","domain","range","scaleQuantize","my","selection","layers","scene","each","centerOfRotation","call","select","offset","on","e","target","datum","selectAll","remove","_v","arguments","length","apply"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\";\nimport dataTransform from \"../dataTransform\";\nimport component from \"../component\";\nimport { dispatch } from \"../events\";\nimport { createScene } from \"../base\";\n\n/**\n * Reusable 3D Scatter Plot Chart\n *\n * @module\n *\n * @example\n * let chartHolder = d3.select(\"#chartholder\");\n *\n * let myData = [...];\n *\n * let myChart = d3.x3d.chart.scatterPlot();\n *\n * chartHolder.datum(myData).call(myChart);\n *\n * @see https://datavizproject.com/data-type/3d-scatterplot/\n */\nexport default function() {\n\n\t/* Default Properties */\n\tlet width = 500;\n\tlet height = 500;\n\tlet dimensions = { x: 40, y: 40, z: 40 };\n\tlet colors = [\"orange\"];\n\tlet color;\n\tlet classed = \"d3X3dScatterPlot\";\n\tlet mappings;\n\tlet debug = false;\n\n\t/* Scales */\n\tlet xScale;\n\tlet yScale;\n\tlet zScale;\n\tlet colorScale;\n\tlet sizeScale;\n\tlet sizeRange = [0.2];\n\n\t/* Components */\n\tconst viewpoint = component.viewpoint();\n\tconst axis = component.axisThreePlane();\n\tconst crosshair = component.crosshair();\n\tconst label = component.label();\n\tconst bubbles = component.bubbles();\n\n\t/**\n\t * Initialise Data and Scales\n\t *\n\t * @private\n\t * @param {Array} data - Chart data.\n\t */\n\tconst init = function(data) {\n\n\t\tlet newData = {};\n\t\t['x', 'y', 'z', 'size', 'color'].forEach((dimension) => {\n\t\t\tlet set = {\n\t\t\t\tkey: dimension,\n\t\t\t\tvalues: []\n\t\t\t};\n\n\t\t\tdata.values.forEach((d) => {\n\t\t\t\tlet key = mappings[dimension];\n\t\t\t\tlet value = d.values.find((v) => v.key === key).value;\n\t\t\t\tset.values.push({ key: key, value: value });\n\t\t\t});\n\n\t\t\tnewData[dimension] = dataTransform(set).summary();\n\t\t});\n\n\t\tlet extentX = newData.x.valueExtent;\n\t\tlet extentY = newData.y.valueExtent;\n\t\tlet extentZ = newData.z.valueExtent;\n\t\tlet extentSize = newData.size.valueExtent;\n\t\tlet extentColor = newData.color.valueExtent;\n\n\t\txScale = d3.scaleLinear()\n\t\t\t.domain(extentX)\n\t\t\t.range([0, dimensions.x]);\n\n\t\tyScale = d3.scaleLinear()\n\t\t\t.domain(extentY)\n\t\t\t.range([0, dimensions.y]);\n\n\t\tzScale = d3.scaleLinear()\n\t\t\t.domain(extentZ)\n\t\t\t.range([0, dimensions.z]);\n\n\t\tsizeScale = d3.scaleLinear()\n\t\t\t.domain(extentSize)\n\t\t\t.range(sizeRange);\n\n\t\tif (color) {\n\t\t\tcolorScale = d3.scaleQuantize()\n\t\t\t\t.domain(extentColor)\n\t\t\t\t.range([color, color]);\n\t\t} else {\n\t\t\tcolorScale = d3.scaleQuantize()\n\t\t\t\t.domain(extentColor)\n\t\t\t\t.range(colors);\n\t\t}\n\t};\n\n\t/**\n\t * Constructor\n\t *\n\t * @constructor\n\t * @alias scatterPlot\n\t * @param {d3.selection} selection - The chart holder D3 selection.\n\t */\n\tconst my = function(selection) {\n\t\tconst layers = [\"axis\", \"bubbles\", \"crosshair\", \"label\"];\n\t\tconst scene = createScene(selection, layers, classed, width, height, debug);\n\n\t\tselection.each((data) => {\n\t\t\tinit(data);\n\n\t\t\t// Add Viewpoint\n\t\t\tviewpoint.centerOfRotation([dimensions.x / 2, dimensions.y / 2, dimensions.z / 2]);\n\n\t\t\tscene.call(viewpoint);\n\n\t\t\t// Add Axis\n\t\t\taxis.xScale(xScale)\n\t\t\t\t.yScale(yScale)\n\t\t\t\t.zScale(zScale);\n\n\t\t\tscene.select(\".axis\")\n\t\t\t\t.call(axis);\n\n\t\t\t// Add Crosshair\n\t\t\tcrosshair.xScale(xScale)\n\t\t\t\t.yScale(yScale)\n\t\t\t\t.zScale(zScale);\n\n\t\t\t// Add Labels\n\t\t\tlabel.xScale(xScale)\n\t\t\t\t.yScale(yScale)\n\t\t\t\t.zScale(zScale)\n\t\t\t\t.offset(0.5);\n\n\t\t\t// Add Bubbles\n\t\t\tbubbles.xScale(xScale)\n\t\t\t\t.mappings(mappings)\n\t\t\t\t.yScale(yScale)\n\t\t\t\t.zScale(zScale)\n\t\t\t\t.sizeScale(sizeScale)\n\t\t\t\t.colorScale(colorScale)\n\t\t\t\t.on(\"d3X3dClick\", function(e) {\n\t\t\t\t\tconst d = d3.select(e.target).datum();\n\t\t\t\t\tscene.select(\".crosshair\")\n\t\t\t\t\t\t.datum(d)\n\t\t\t\t\t\t.classed(\"crosshair\", true)\n\t\t\t\t\t\t.each(function() {\n\t\t\t\t\t\t\td3.select(this).call(crosshair);\n\t\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.on(\"d3X3dMouseOver\", function(e) {\n\t\t\t\t\tconst d = d3.select(e.target).datum();\n\t\t\t\t\tscene.select(\".label\")\n\t\t\t\t\t\t.datum(d)\n\t\t\t\t\t\t.each(function() {\n\t\t\t\t\t\t\td3.select(this).call(label);\n\t\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.on(\"d3X3dMouseOut\", function(e) {\n\t\t\t\t\tscene.select(\".label\")\n\t\t\t\t\t\t.selectAll(\"*\")\n\t\t\t\t\t\t.remove();\n\t\t\t\t});\n\n\t\t\tscene.select(\".bubbles\")\n\t\t\t\t.datum(data)\n\t\t\t\t.call(bubbles);\n\t\t});\n\t};\n\n\t/**\n\t * Width Getter / Setter\n\t *\n\t * @param {number} _v - X3D canvas width in px.\n\t * @returns {*}\n\t */\n\tmy.width = function(_v) {\n\t\tif (!arguments.length) return width;\n\t\twidth = _v;\n\t\treturn this;\n\t};\n\n\t/**\n\t * Height Getter / Setter\n\t *\n\t * @param {number} _v - X3D canvas height in px.\n\t * @returns {*}\n\t */\n\tmy.height = function(_v) {\n\t\tif (!arguments.length) return height;\n\t\theight = _v;\n\t\treturn this;\n\t};\n\n\t/**\n\t * Dimensions Getter / Setter\n\t *\n\t * @param {{x: number, y: number, z: number}} _v - 3D object dimensions.\n\t * @returns {*}\n\t */\n\tmy.dimensions = function(_v) {\n\t\tif (!arguments.length) return dimensions;\n\t\tdimensions = _v;\n\t\treturn this;\n\t};\n\n\t/**\n\t * X Scale Getter / Setter\n\t *\n\t * @param {d3.scale} _v - D3 scale.\n\t * @returns {*}\n\t */\n\tmy.xScale = function(_v) {\n\t\tif (!arguments.length) return xScale;\n\t\txScale = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Y Scale Getter / Setter\n\t *\n\t * @param {d3.scale} _v - D3 scale.\n\t * @returns {*}\n\t */\n\tmy.yScale = function(_v) {\n\t\tif (!arguments.length) return yScale;\n\t\tyScale = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Z Scale Getter / Setter\n\t *\n\t * @param {d3.scale} _v - D3 scale.\n\t * @returns {*}\n\t */\n\tmy.zScale = function(_v) {\n\t\tif (!arguments.length) return zScale;\n\t\tzScale = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Size Scale Getter / Setter\n\t *\n\t * @param {d3.scale} _v - D3 color scale.\n\t * @returns {*}\n\t */\n\tmy.sizeScale = function(_v) {\n\t\tif (!arguments.length) return sizeScale;\n\t\tsizeScale = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Size Range Getter / Setter\n\t *\n\t * @param {number[]} _v - Size min and max (e.g. [1, 9]).\n\t * @returns {*}\n\t */\n\tmy.sizeRange = function(_v) {\n\t\tif (!arguments.length) return sizeRange;\n\t\tsizeRange = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Color Scale Getter / Setter\n\t *\n\t * @param {d3.scale} _v - D3 color scale.\n\t * @returns {*}\n\t */\n\tmy.colorScale = function(_v) {\n\t\tif (!arguments.length) return colorScale;\n\t\tcolorScale = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Color Getter / Setter\n\t *\n\t * @param {string} _v - Color (e.g. \"red\" or \"#ff0000\").\n\t * @returns {*}\n\t */\n\tmy.color = function(_v) {\n\t\tif (!arguments.length) return color;\n\t\tcolor = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Colors Getter / Setter\n\t *\n\t * @param {Array} _v - Array of colours used by color scale.\n\t * @returns {*}\n\t */\n\tmy.colors = function(_v) {\n\t\tif (!arguments.length) return colors;\n\t\tcolors = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Size Scale Getter / Setter\n\t *\n\t * @param {d3.scale} _v - D3 color scale.\n\t * @returns {*}\n\t */\n\tmy.sizeScale = function(_v) {\n\t\tif (!arguments.length) return sizeScale;\n\t\tsizeScale = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Size Range Getter / Setter\n\t *\n\t * @param {number[]} _v - Size min and max (e.g. [0.5, 3.0]).\n\t * @returns {*}\n\t */\n\tmy.sizeRange = function(_v) {\n\t\tif (!arguments.length) return sizeRange;\n\t\tsizeRange = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Mappings Getter / Setter\n\t *\n\t * @param {Object} _v - Map properties to size, colour etc.\n\t * @returns {*}\n\t */\n\tmy.mappings = function(_v) {\n\t\tif (!arguments.length) return mappings;\n\t\tmappings = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Debug Getter / Setter\n\t *\n\t * @param {boolean} _v - Show debug log and stats. True/False.\n\t * @returns {*}\n\t */\n\tmy.debug = function(_v) {\n\t\tif (!arguments.length) return debug;\n\t\tdebug = _v;\n\t\treturn my;\n\t};\n\n\t/**\n\t * Dispatch On Getter\n\t *\n\t * @returns {*}\n\t */\n\tmy.on = function() {\n\t\tlet value = dispatch.on.apply(dispatch, arguments);\n\t\treturn value === dispatch ? my : value;\n\t};\n\n\treturn my;\n}\n"]},"metadata":{},"sourceType":"module"}